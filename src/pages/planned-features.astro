---
import Layout from '~/layouts/Layout.astro';
import TopNav from '~/components/TopNav.astro';
import Footer from '~/components/Footer.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import JobberIntegration from '~/components/JobberIntegration.astro';
import { Icon } from 'astro-icon/components';

const metadata = {
  title: 'Planned Features',
  description: 'A look at features planned for future releases.',
};
---

<Layout metadata={metadata}>
  <TopNav />
  <main>
    <WidgetWrapper>
      <Headline
        tagline="Planned features"
        title="What is coming after version one"
        subtitle="These features are not part of the initial release, but they are on the roadmap and planned for a future update."
        classes={{ container: 'max-w-3xl' }}
      />
      <div class="mt-8 grid gap-4 sm:grid-cols-3">
        <a
          class="group rounded-2xl border border-gray-200/60 bg-white/90 p-4 text-left shadow-sm transition hover:border-primary/60 hover:bg-white dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80 dark:hover:border-green-800/70"
          href="#jobber-integration"
        >
          <Icon name="tabler:plug-connected" class="h-8 w-8 text-primary" />
          <p class="mt-4 text-base font-semibold text-heading">CRM integration</p>
          <p class="mt-1 text-sm text-muted">Jobber pipeline automation</p>
        </a>
        <a
          class="group rounded-2xl border border-gray-200/60 bg-white/90 p-4 text-left shadow-sm transition hover:border-primary/60 hover:bg-white dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80 dark:hover:border-green-800/70"
          href="#zapier-integration"
        >
          <Icon name="tabler:bolt" class="h-8 w-8 text-primary" />
          <p class="mt-4 text-base font-semibold text-heading">Zapier integration</p>
          <p class="mt-1 text-sm text-muted">No-code automations</p>
        </a>
        <a
          class="group rounded-2xl border border-gray-200/60 bg-white/90 p-4 text-left shadow-sm transition hover:border-primary/60 hover:bg-white dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80 dark:hover:border-green-800/70"
          href="#instant-price-form"
        >
          <Icon name="tabler:forms" class="h-8 w-8 text-primary" />
          <p class="mt-4 text-base font-semibold text-heading">Instant price form</p>
          <p class="mt-1 text-sm text-muted">On-site quote</p>
        </a>
      </div>
    </WidgetWrapper>

    <JobberIntegration />

    <WidgetWrapper id="zapier-integration">
      <Headline
        tagline="Zapier integration"
        title="Connect Mowing Bidder to the tools you already use."
        subtitle="Trigger quote creation and pricing updates from your favorite apps without writing any code."
        classes={{ container: 'max-w-3xl' }}
      />
      <div class="mt-6 grid gap-4 sm:grid-cols-3">
        {
          ['New lead created', 'Address updated', 'Price sent back'].map((item) => (
            <div class="rounded-2xl border border-gray-200/60 bg-white/90 p-4 text-sm text-heading shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80">
              <p class="text-xs uppercase tracking-wide text-muted">Trigger</p>
              <p class="mt-2 font-semibold">{item}</p>
            </div>
          ))
        }
      </div>
    </WidgetWrapper>

    <WidgetWrapper id="instant-price-form">
      <Headline
        tagline="Instant price form"
        title="Provide instant pricing right on your website."
        subtitle="Let homeowners request quotes without leaving your site, powered by the same pricing formula."
        classes={{ container: 'max-w-3xl' }}
      />
      <div
        class="mt-6 rounded-2xl border border-gray-200/60 bg-white/90 p-6 shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#1f1f1f]/80"
      >
        <div class="grid gap-6">
          <div
            class="instant-form relative rounded-xl border border-gray-200/60 bg-white/95 p-4 shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#1a1a1a]"
          >
            <p class="text-xs uppercase tracking-wide text-muted">Instant price form</p>
            <div class="mt-4 space-y-3">
              <div
                class="rounded-lg border border-gray-200/60 bg-white px-3 py-2 text-sm text-heading shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#121212]"
              >
                <p class="text-[11px] uppercase tracking-wide text-muted">Property address</p>
                <div class="instant-input mt-1" data-instant-typed>
                  <span class="instant-typed" aria-hidden="true"></span>
                  <span class="instant-caret" aria-hidden="true"></span>
                </div>
              </div>
              <div
                class="instant-submit relative inline-flex w-full items-center justify-center rounded-full border border-gray-400 bg-transparent px-5 py-2 text-sm font-semibold text-page"
              >
                Submit for instant price
              </div>
              <div
                class="instant-price rounded-lg border border-gray-200/60 bg-white px-3 py-2 text-sm text-heading shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#121212]"
              >
                <p class="text-[11px] uppercase tracking-wide text-muted">Instant price</p>
                <p class="mt-1 text-lg font-semibold text-heading">$54 / visit</p>
              </div>
              <div
                class="instant-price rounded-lg border border-gray-200/60 bg-white px-3 py-2 text-sm text-heading shadow-sm dark:border-[#2f2f2f]/60 dark:bg-[#121212]"
              >
                <p class="text-[11px] uppercase tracking-wide text-muted">Bi-weekly price</p>
                <p class="mt-1 text-lg font-semibold text-heading">$80 / visit</p>
              </div>
              <button class="instant-accept w-full rounded-full bg-primary px-5 py-2 text-sm font-semibold text-white">
                Accept price
              </button>
            </div>
            <span class="instant-mouse" aria-hidden="true"></span>
          </div>
        </div>
        <p class="mt-4 text-sm text-muted">
          Embed as a simple widget and route submissions directly into your pipeline.
        </p>
      </div>
    </WidgetWrapper>
  </main>
  <Footer />
</Layout>

<style>
  .instant-input {
    min-height: 20px;
    display: flex;
    align-items: center;
    font-size: 0.95rem;
    position: relative;
  }

  .instant-typed {
    display: inline-block;
    white-space: nowrap;
  }

  .instant-caret {
    width: 1px;
    height: 16px;
    margin-left: 2px;
    background: #1f7a45;
    animation: instant-caret 1s steps(1) infinite;
  }

  .instant-mouse {
    position: absolute;
    left: 62%;
    top: 86px;
    width: 28px;
    height: 28px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 28 28'%3E%3Cpath d='M5 2 L23 14 L16.5 16.5 L21 26 L17 27 L12.5 17.5 L5 22 Z' fill='%23000' stroke='%23fff' stroke-width='2' stroke-linejoin='round'/%3E%3C/svg%3E");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    filter: drop-shadow(0 6px 10px rgba(15, 23, 42, 0.2));
    animation: none;
    opacity: 0;
    pointer-events: none;
  }

  .instant-mouse::after {
    content: none;
  }

  .instant-price {
    opacity: 0;
    transform: translateY(6px);
  }

  .instant-accept {
    opacity: 0;
    transform: translateY(6px);
  }

  @keyframes instant-caret {
    50% {
      opacity: 0;
    }
  }

  @keyframes instant-mouse {
    0% {
      transform: translate(0, 0);
      opacity: 1;
    }
    70% {
      transform: translate(0, 75px) scale(0.98);
      opacity: 1;
    }
    100% {
      transform: translate(0, 75px) scale(0.98);
      opacity: 1;
    }
  }

  .instant-submit {
    transition:
      box-shadow 200ms ease,
      transform 200ms ease,
      border-color 200ms ease;
    animation: none;
  }

  .instant-run .instant-mouse {
    animation: instant-mouse 1.5s ease-out;
    animation-fill-mode: both;
  }

  .instant-run .instant-submit {
    animation: instant-submit 2s ease-in-out;
  }

  .instant-run .instant-price {
    animation: instant-price 2.6s ease-in-out;
    animation-fill-mode: both;
  }

  .instant-run .instant-accept {
    animation: instant-accept 3s ease-in-out;
    animation-fill-mode: both;
  }

  @keyframes instant-submit {
    0%,
    68% {
      box-shadow: none;
      transform: translateY(0);
      border-color: rgba(107, 114, 128, 1);
    }
    82% {
      box-shadow: 0 0 0 3px rgba(31, 122, 69, 0.2);
      border-color: rgba(31, 122, 69, 0.6);
      transform: translateY(0);
    }
    86% {
      box-shadow: 0 0 0 4px rgba(31, 122, 69, 0.25);
      border-color: rgba(31, 122, 69, 0.8);
      transform: translateY(3px);
    }
    90%,
    100% {
      box-shadow: none;
      transform: translateY(0);
      border-color: rgba(107, 114, 128, 1);
    }
  }

  @keyframes instant-price {
    0%,
    75% {
      opacity: 0;
      transform: translateY(8px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes instant-accept {
    0%,
    85% {
      opacity: 0;
      transform: translateY(8px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  const typedContainer = document.querySelector('[data-instant-typed]');
  const formEl = document.querySelector('.instant-form');
  if (typedContainer) {
    const typedEl = typedContainer.querySelector('.instant-typed');
    if (typedEl) {
      const fullText = '7421 W 151st St, Overland Park, KS';
      let index = 0;
      const total = fullText.length;
      const stepMs = 60;
      const pauseMs = 0;
      const runDurationMs = 2000;
      const postRunPauseMs = 2000;

      const typeNext = () => {
        if (!typedEl) return;
        if (index <= total) {
          typedEl.textContent = fullText.slice(0, index);
          index += 1;
          setTimeout(typeNext, stepMs);
        } else {
          setTimeout(() => {
            if (formEl) {
              formEl.classList.add('instant-run');
              setTimeout(() => {
                setTimeout(() => {
                  formEl.classList.remove('instant-run');
                  index = 0;
                  typedEl.textContent = '';
                  setTimeout(typeNext, stepMs);
                }, postRunPauseMs);
              }, runDurationMs);
            } else {
              index = 0;
              typedEl.textContent = '';
              setTimeout(typeNext, stepMs);
            }
          }, pauseMs);
        }
      };

      typeNext();
    }
  }
</script>
